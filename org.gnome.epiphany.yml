app-id: org.gnome.Epiphany
runtime: io.elementary.Platform
runtime-version: '6'
sdk: io.elementary.Sdk
command: epiphany
finish-args:
  - '--device=all'
  - '--filesystem=/run/.heim_org.h5l.kcm-socket'
  - '--filesystem=xdg-download'
  - '--share=ipc'
  - '--share=network'
  - '--socket=fallback-x11'
  - '--socket=pulseaudio'
  - '--socket=wayland'
  - '--system-talk-name=org.freedesktop.GeoClue2'

  # needed for prefers-color-scheme
  - '--system-talk-name=org.freedesktop.Accounts'
modules:
  - name: dazzle
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/libdazzle.git
        tag: '3.38.0'

  - name: libportal
    buildsystem: meson
    config-opts:
      - '-Dgtk_doc=false'
    sources:
      - type: git
        url: https://github.com/flatpak/libportal.git
        tag: '0.4'

  - name: webkit
    buildsystem: cmake
    config-opts:
    - '-DPORT=GTK'
    - '-DENABLE_BUBBLEWRAP_SANDBOX=ON'
    - '-DUSE_SOUP2=ON' # Once GNOME Web 41 is available, turn this off and include libsoup3 as a dependency
    sources:
      - type: archive
        url: https://webkitgtk.org/releases/webkitgtk-2.34.1.tar.xz
        sha256: 443c1316705de024741748e85fe32324d299d9ee68e6feb340b89e4a04073dee
    modules:
      - name: evdev
        buildsystem: meson
        config-opts:
        - '-Dtests=disabled'
        sources:
          - type: git
            url: https://gitlab.freedesktop.org/libevdev/libevdev.git
            tag: 'libevdev-1.11.0'
      - name: manette
        buildsystem: meson
        sources:
          - type: git
            url: https://gitlab.gnome.org/GNOME/libmanette.git
            commit: '0.2.6'
      - name: bubblewrap
        sources:
          - type: git
            url: https://github.com/containers/bubblewrap.git
            tag: 'v0.5.0'
      - name: xdg-dbus-proxy
        sources:
          - type: git
            url: https://github.com/flatpak/xdg-dbus-proxy.git
            tag: '0.1.2'

  - name: epiphany
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/epiphany.git
        tag: '3.38.6'
        commit: 73615c0fc1f76842aa7ee98614c10de398b809ae
        disable-shallow-clone: true
      - type: patch
        path: dark-style.patch
      - type: patch
        path: navigation-buttons.patch
